window.localStorage||(window.localStorage={getItem:function(a){return a&&this.hasOwnProperty(a)?unescape(document.cookie.replace(new RegExp("(?:^|.*;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*((?:[^;](?!;))*[^;]?).*"),"$1")):null},key:function(a){return unescape(document.cookie.replace(/\s*\=(?:.(?!;))*$/,"").split(/\s*\=(?:[^;](?!;))*[^;]?;\s*/)[a])},setItem:function(a,b){a&&(document.cookie=escape(a)+"="+escape(b)+"; expires=Tue, 19 Jan 2038 03:14:07 GMT; path=/",this.length=document.cookie.match(/\=/g).length)},length:0,removeItem:function(a){a&&this.hasOwnProperty(a)&&(document.cookie=escape(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/",this.length--)},hasOwnProperty:function(a){return new RegExp("(?:^|;\\s*)"+escape(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie)}},window.localStorage.length=(document.cookie.match(/\=/g)||window.localStorage).length);var docCookies={getItem:function(a){return a?decodeURIComponent(document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1"))||null:null},setItem:function(a,b,c,d,e,f){if(!a||/^(?:expires|max\-age|path|domain|secure)$/i.test(a))return!1;var g="";if(c)switch(c.constructor){case Number:g=1/0===c?"; expires=Fri, 31 Dec 9999 23:59:59 GMT":"; max-age="+c;break;case String:g="; expires="+c;break;case Date:g="; expires="+c.toUTCString()}return document.cookie=encodeURIComponent(a)+"="+encodeURIComponent(b)+g+(e?"; domain="+e:"")+(d?"; path="+d:"")+(f?"; secure":""),!0},removeItem:function(a,b,c){return this.hasItem(a)?(document.cookie=encodeURIComponent(a)+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT"+(c?"; domain="+c:"")+(b?"; path="+b:""),!0):!1},hasItem:function(a){return a?new RegExp("(?:^|;\\s*)"+encodeURIComponent(a).replace(/[\-\.\+\*]/g,"\\$&")+"\\s*\\=").test(document.cookie):!1},keys:function(){for(var a=document.cookie.replace(/((?:^|\s*;)[^\=]+)(?=;|$)|^\s*|\s*(?:\=[^;]*)?(?:\1|$)/g,"").split(/\s*(?:\=[^;]*)?;\s*/),b=a.length,c=0;b>c;c++)a[c]=decodeURIComponent(a[c]);return a}};!function(a){var b,c,d={callIframe:function(a,b){var c,d=document.getElementById("gaijin-menu-iframe");d?(d.setAttribute("src",a),c=!0):(d=document.createElement("iframe"),d.setAttribute("src",a),d.style.width="1px",d.style.height="1px",d.style.top="-100px",d.style.position="absolute",d.id="gaijin-menu-iframe",d.name="gaijin-menu-iframe"),d.addEventListener("load",function(){b(d.contentWindow)}.bind(this)),c||document.body.appendChild(d)},redrawPanel:function(a,b){requirejs.undef("menu"),b.innerHTML=a,requirejs(["menu"],function(){})},loadCss:function(a){var b=document.createElement("link");b.type="text/css",b.rel="stylesheet",b.href=a,document.getElementsByTagName("head")[0].appendChild(b)},getOptions:function(a,b){var c,d,e,f={},g=a.length;for(c=0;g>c;c++)d=a[c],e=b.getAttribute("data-"+d),null!==e&&""!==e&&(f[d]=e);return f},extend:function(){var a,b,c,d=Array.prototype.slice.call(arguments),e=d[0]||{},f=d.length;for(a=1;f>a;a++){b=d[a];for(c in b)Object.prototype.hasOwnProperty.call(b,c)&&"undefined"!=typeof b[c]&&(e[c]=b[c])}return e},getDomain:function(a){return a.toString().replace(/http[s]?:\/\/([^\/]+).*/i,"$1")},correctLang:function(a){switch(a.toString()){case"cz":return"cs";case"jp":return"ja"}return a},login:function(a,b){window.localStorage.setItem("gm_login",JSON.stringify({"sso-nick":b,"sso-id":a}))},getCred:function(){try{return JSON.parse(window.localStorage.getItem("gm_login"))}catch(a){return{}}},logout:function(){window.localStorage.removeItem("gm_login")},isAuth:function(){return window.localStorage.hasOwnProperty("gm_login")}};a.Gaijin=a.Gaijin||{};var e=document.getElementById("gm-loader"),f="";"undefined"!=typeof e&&(f=e.getAttribute("src").match(/https?:\/\/[^\/]+/)),f||(f=location.href.match(/https?:\/\/[^\/]+/)),a.Gaijin.Menu={ssoUrl:f,options:{"i18n-crt-language":"","i18n-spt-languages":"en,de,fr,cs,pl,es,it,ja,ko,pt,ru,tr,zh","prt-origin-url":"","prt-name":"","prt-lang-url":"","prt-lang-additional-url":"","prt-reg-url":"","prt-logout-url":"","sso-return":"","sso-crc":"","sso-key":"","sso-refresh":0,"sso-nick":"","sso-id":"","sso-sid":"","additional-links":"","hide-login":!1,"hide-reg":!1,"hide-profile":!1,autologin:!1,"go-link":"","show-lang-selector":!0},logout:function(a,e){return a.href&&(c=a.href),d.logout(),b.postMessage(JSON.stringify({action:"location",location:this.ssoUrl+"/api/auth/menu/logout?origin="+location.origin+"&sid="+e}),this.ssoUrl),!1},init:function(){var a=document.getElementById("gaijin-menu"),f=Object.keys(this.options);this.options=d.extend(this.options,d.getOptions(f,e)),this.options["i18n-spt-languages"]=this.options["i18n-spt-languages"].split(",");try{this.options["additional-links"]=JSON.parse(this.options["additional-links"])}catch(g){this.options["additional-links"]=""}this.options["go-link"]||(this.options["go-link"]="//store.gaijin.net/");var h=this.options["sso-nick"]&&this.options["sso-id"],i=!1;h?d.login(this.options["sso-id"],this.options["sso-nick"]):d.isAuth()&&(this.options=d.extend(this.options,d.getCred()),i=!0);var j="ru"==this.options["i18n-crt-language"]?"ru":"en";this.options["prt-reg-url"]||(this.options["prt-reg-url"]=this.ssoUrl+"/"+j+"/profile/register");var k,l,m=d.correctLang(this.options["i18n-crt-language"]);if(this.options["prt-origin-url"]&&this.options["sso-return"]&&this.options["sso-crc"]&&this.options["sso-key"]){var n=d.getDomain(this.options["prt-origin-url"]),o="?return_url="+this.options["sso-return"]+"&crc="+this.options["sso-crc"]+"&public_key="+this.options["sso-key"]+"&domain="+n;k=this.ssoUrl+"/"+j+"/sso/login"+o,l=this.options["prt-logout-url"]?this.options["prt-logout-url"]:this.ssoUrl+"/"+j+"/sso/logout"+o,this.options["sso-refresh"]&&(k+="&refresh_token=1");var p=docCookies.getItem("mnm_key");p&&(k+="&mnm_key="+p)}var q='<nav class="top-panel gaijin-menu"><ul class="top-panel__nav-list">{{#viewLangSelector}}<li class="top-panel__item language-selector"><a class="top-panel__link top-panel__link--caret" href="#"><span class="flag {{language}}"></span> {{l10n.language}}</a><div class="top-panel__drop-list"><ul class="top-panel__inner-list">{{#languages}}<li class="top-panel__inner-list__item lang__link_inner-list"><a class="lang__link_inner-list" href="{{lang_url}}{{.}}{{lang_additional_url}}"><span class="flag {{l10n_language_code}}"></span> {{ l10n_language }}</a></li>{{/languages}}</ul></div></li>{{/viewLangSelector}}<li class="top-panel__item"><a class="top-panel__gaijin-logo" href="{{l10n.gaijin_link}}"></a></li>{{^hide_profile}}<li class="top-panel__item {{^isAuth}}top-panel__item--long{{/isAuth}}">{{#isAuth}}<a class="top-panel__link top-panel__link--caret" href="#">{{user_name}}</a><div class="top-panel__drop-list "><ul class="top-panel__inner-list "><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n_profile_link}}">{{l10n.profileBtn}}</a></li><hr><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{login_link}}">{{l10n.changeAccount}}</a></li><hr><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{logout_link}}" onclick="return Gaijin.Menu.logout(this,\''+this.options["sso-sid"]+'\');">{{l10n.logoutBtn}}</a></li></ul></div>{{/isAuth}}{{^isAuth}}{{^hide_login}}<a class="top-panel__link" href="{{login_link}}">{{l10n.loginBtn}}</a>{{#hide_reg}}<span class="top-panel__text">&nbsp;</span>{{/hide_reg}}{{^hide_reg}}<span class="top-panel__text">{{l10n.or}}</span>{{/hide_reg}}{{/hide_login}}{{^hide_reg}}<a class="top-panel__link{{#hide_login}} pad{{/hide_login}}" href="{{register_link}}">{{l10n.registerBtn}}</a>{{/hide_reg}}{{/isAuth}}</li>{{/hide_profile}}<li class="top-panel__item"><a class="top-panel__link" href="{{l10n_go_url}}">{{l10n.store}}</a></li><li class="top-panel__item"><a class="top-panel__link top-panel__link--caret" href="#">{{l10n.games}}</a><div class="top-panel__drop-list top-panel__inner-list--right-orientation"><div class="top-panel__games-list js-games-list"><div class="top-panel__game-item top-panel__game-item--big"><a href="{{l10n.wt_url}}"><div class="top-panel__game-img top-panel__game-img--wt"></div><div class="game-img__shadow"></div><div class="top-panel__game-title">War Thunder</div> </a> </div><div class="top-panel__game-item top-panel__game-item--big"><a href="{{l10n.sc_url}}"><div class="top-panel__game-img top-panel__game-img--sc"></div><div class="game-img__shadow"></div><div class="top-panel__game-title">Star Conflict</div></a> </div><div class="top-panel__game-item top-panel__game-item--big"><a href="{{l10n.xo_url}}"><div class="top-panel__game-img top-panel__game-img--wop"></div><div class="game-img__shadow"></div><div class="top-panel__game-title">Crossout</div></a></div></div><ul class="top-panel__inner-list  top-panel__inner-list--inlined"><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.forum_wt_url}}">{{l10n.forum}}</a></li><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.forum_sc_url}}">{{l10n.forum}}</a></li><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.forum_xo_url}}">{{l10n.forum}}</a></li><hr class="hr"/><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.wiki_wt_url}}">Wiki</a></li><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.wiki_sc_url}}">Wiki</a></li><hr class="hr"/><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.live_url}}">Live</a></li></ul></div></li><li class="top-panel__item"><a class="top-panel__link top-panel__link--caret" href="#">{{l10n.support}}</a><div class="top-panel__drop-list "><ul class="top-panel__inner-list "><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.support_url}}">{{l10n.supportSite}}</a></li><hr /><li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="{{l10n.support_url}}/requests">{{l10n.help}}</a></li></ul></div></li>{{#additionalLinks}}{{{additional}}}{{/additionalLinks}}</ul></nav>';requirejs.config({baseUrl:this.ssoUrl+"/gm/js",paths:{app:"../loader"},config:{i18n:{locale:m}},urlArgs:"v=5"}),d.loadCss(this.ssoUrl+"/gm/css/menu.css");var r=function(e,f){requirejs(["mustache.min"],function(g){var j={viewLangSelector:+this.options["show-lang-selector"],l10n:e,isAuth:i,logout_link:l,login_link:k,register_link:this.options["prt-reg-url"],lang_url:this.options["prt-lang-url"],lang_additional_url:this.options["prt-lang-additional-url"],user_name:this.options["sso-nick"],hide_login:this.options["hide-login"],hide_reg:this.options["hide-reg"],hide_profile:this.options["hide-profile"],language:m,languages:this.options["i18n-spt-languages"],l10n_profile_link:function(){var a=e.profile_link;return new RegExp("/^///").test(a)||(a=this.options["go-link"]+a),a}.bind(this),l10n_go_url:function(){var a=e.go_url;return new RegExp("/^///").test(a)||(a=this.options["go-link"]+a),a}.bind(this),l10n_language:function(){return e[d.correctLang(this)]},l10n_language_code:function(){return d.correctLang(this)},additionalLinks:this.options["additional-links"],additional:function(){if(this.childs){var a='<li class="top-panel__item"><a class="top-panel__link top-panel__link--caret" href="'+this.url+'">'+this.title+"</a>";a+='<div class="top-panel__drop-list"><ul class="top-panel__inner-list">';for(var b in this.childs){var c=this.childs[b];a+='<li class="top-panel__inner-list__item"><a class="top-panel__inner-list__link" href="'+c.url+'">'+c.title+"</a></li>",this.childs.length!=+b+1&&(a+='<hr class="hr" />')}return a+="</ul></div></li>"}return'<li class="top-panel__item"><a class="top-panel__link" href="'+this.url+'">'+this.title+"</a></li>"}};f||(window.addEventListener("message",function(b){if(!this.options["hide-profile"]&&b.origin&&-1!==b.origin.indexOf(this.ssoUrl))try{var e=JSON.parse(b.data);switch(e.action){case"isAuth":if(JSON.stringify(e.data)==localStorage.getItem("eventdata"))break;localStorage.setItem("eventdata",JSON.stringify(e.data)),3==e.data.status?location.href=k+"&autologin=1":2==e.data.status?(j.isAuth=!1,j.user_name="",d.logout(),h&&(location.href=l)):d.isAuth()?h||(e.data.status?this.options.autologin&&(location.href=k+"&autologin=1"):(j.isAuth=!1,j.user_name="",d.logout(),d.redrawPanel(g.render(q,j),a))):e.data.status&&e.data&&e.data["sso-nick"]&&e.data["sso-id"]&&(this.options.autologin?location.href=k+"&autologin=1":(j.isAuth=!0,j.user_name=e.data["sso-nick"],d.login(e.data["sso-id"],e.data["sso-nick"]),d.redrawPanel(g.render(q,j),a)));break;case"logout":c&&(location.href=c)}}catch(f){}}.bind(this),!1),d.callIframe(this.ssoUrl+"/api/auth/menu/?origin="+location.origin+"&sid="+this.options["sso-sid"]+"&id="+this.options["sso-id"],function(a){b=a}.bind(this))),d.isAuth()&&(this.options=d.extend(this.options,d.getCred()),j.user_name=this.options["sso-nick"],j.isAuth=!0),d.redrawPanel(g.render(q,j),a)}.bind(this))}.bind(this),s=function(a,b){"undefined"==typeof $?requirejs(["jquery-1.11.0.min"],function(){r(a,b)}):r(a,b)}.bind(this),t=!1;if(window.localStorage.hasOwnProperty("gm_l10n"))try{s(JSON.parse(window.localStorage.getItem("gm_l10n")),t),t=!0}catch(g){}define(["nls/"+m+"/menu"],function(a){s(a,t)}.bind(this))}},a.Gaijin.Menu.init()}(window);